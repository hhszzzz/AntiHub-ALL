services:
  # 一次性数据库初始化/同步任务：
  # - 解决 postgres 数据卷已存在时 initdb.d 不会再次执行的问题
  # - 确保 POSTGRES_USER/POSTGRES_DB 与 .env 保持一致（仅 Backend 单库）
  #
  # 使用方式（推荐 deploy.sh 自动执行）：
  #   docker compose -f docker-compose.yml -f docker/docker-compose.db-init.yml run --rm db-init
  db-init:
    image: postgres:18.1-alpine
    depends_on:
      postgres:
        condition: service_healthy
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-antihub}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-please-change-me}
      POSTGRES_DB: ${POSTGRES_DB:-antihub}
    volumes:
      - ./postgres/sync-db.sh:/sync-db.sh:ro
    command: ["sh", "/sync-db.sh"]
    restart: "no"
